# 简单写一下STA2002 Chapter 1-5 的内容
# 还没学会怎么用LaTex，所以就直接在R里面写了

# Chapter 1


# Chapter 2


# Chapter 3


# Chapter 4: Point Estimators 点估计
# 这一章具体来说讲解了两个内容：点估计的两种常用方法 -- 最大似然估计和矩估计
  # 也就是Maximum Likelihood Estimation (MLE) 和 Method of Moments Estimation (MOM)
  # 先从Maximum Likelihood Estimation (MLE)开始

# 1. Maximum Likelihood Estimation (MLE)
# 1.1 似然函数 -- Likelihood Function
  # 假设存在一个总体分布，我们不知道这个分布的具体形式，但是我们有一些样本数据，
  # 我们可以通过这些样本数据来估计这个总体分布的参数
  # 似然函数就是用来描述这个样本数据在不同参数下出现的概率
  # 我们用大写的L表示似然函数，用θ表示总体分布的参数，用x表示样本数据
  # 似然函数的定义：L(θ) = f(x1, x2, ..., xn | θ)
  # 其中，θ是总体分布的参数，x1, x2, ..., xn是样本数据
  # 似然函数的值越大，说明这个参数越有可能是真实的参数
  # 似然函数的值越小，说明这个参数越不可能是真实的参数

# 1.2 似然函数的对数 -- Log-Likelihood Function
  # 似然函数的值通常非常小，为了方便计算，我们通常会对似然函数取对数
  # 对似然函数取对数之后，我们就可以将似然函数的乘法转化为对数的加法
  # 我们就可以将似然函数的值从很小的小数转化为一个更容易理解的数值
  # 从而可以更容易地计算似然函数的导数，从而找到似然函数的最大值

  # 我们用小写的l表示似然函数的对数，用θ表示总体分布的参数，用x表示样本数据
  # 似然函数的对数的定义：l(θ) = log(L(θ)) = log(f(x1, x2, ..., xn | θ))
  # 其中，θ是总体分布的参数，x1, x2, ..., xn是样本数据
  # 此处的log一般是以e为底的自然对数，也就是ln

# 1.3 最大似然估计 -- Maximum Likelihood Estimation (MLE)
  # 最大似然估计是一种常用的参数估计方法
  # 最大似然估计的思想是：在所有可能的参数值中，选择使得似然函数取最大值的参数作为估计值
  # 也就是说，我们要找到一个参数值，使得这个参数值下的似然函数的值最大
  # 
  # 我们使用似然函数的对数来进行最大似然估计
  # 我们对似然函数的对数求一阶导，然后令导数等于0，继续求出二阶导并判断正负号
  # （这是MAT3007及最优化optimization里面的内容）
  # 解方程，就可以得到最大似然估计值
  # 解出来的θ就是最大似然估计值

# 1.4 例子
  # 举一个简单的例子，假设我们有一个二项分布的样本数据，我们要估计这个二项分布的参数
  # 二项分布的概率质量函数是：f(x | n, p) = C(n, x) * p^x * (1-p)^(n-x)
  # 其中，n是试验次数，x是成功次数，p是成功的概率
  # 我们有一组样本数据x1, x2, ..., xn，我们要估计这个二项分布的参数n和p
  # 我们可以使用最大似然估计来估计这个二项分布的参数n和p
  # 我们可以写出似然函数L(n, p) = f(x1, x2, ..., xn | n, p)
  # 我们可以写出似然函数的对数l(n, p) = log(L(n, p))
  # 我们对似然函数的对数求一阶导，然后令导数等于0，继续求出二阶导并判断正负号
  # 解方程，就可以得到最大似然估计值
  # 解出来的n和p就是最大似然估计值
  
# 2 矩估计 -- Method of Moments Estimation (MOM)
  # 矩估计是另一种常用的参数估计方法
  # 矩估计的思想是：使用样本矩来估计总体矩，然后使用总体矩来估计总体参数
  # 矩估计的步骤是：首先计算样本矩，然后计算总体矩，最后使用总体矩来估计总体参数
  # 
  # 矩估计的步骤：
  # 1. 计算样本矩：样本矩是样本数据的函数，用来估计总体矩
  # 2. 计算总体矩：总体矩是总体分布的函数，用来估计总体参数
  # 3. 使用总体矩来估计总体参数：将总体矩的函数与总体参数的函数相等，解方程，得到总体参数的估计值 

# 2.1 例子
  # 举一个简单的例子，假设我们有一个正态分布的样本数据，我们要估计这个正态分布的参数
  # 正态分布的概率密度函数是：f(x | μ, σ) = 1 / (σ * sqrt(2 * π)) * exp(-(x - μ)^2 / (2 * σ^2))
  # 其中，μ是均值，σ是标准差
  # 我们有一组样本数据x1, x2, ..., xn，我们要估计这个正态分布的参数μ和σ
  # 我们可以使用矩估计来估计这个正态分布的参数μ和σ
  # 我们可以写出样本矩和总体矩的表达式
  # 我们可以将样本矩的表达式与总体矩的表达式相等，解方程，得到总体参数的估计值
  # 解出来的μ和σ就是矩估计值
  
# 假设检验：你需要的一切

# 0.0 前置知识
# 在学习假设检验之前，我们需要掌握一些前置知识
# 你应该具备以下知识：
# 1. 概率论和数理统计的基本知识
# 2. 几种常见的概率分布，例如正态分布、二项分布、泊松分布等
# 3. 重要的分布比如t分布、F分布、卡方分布等

# 1.1 - 为什么我们需要假设检验？
# 假设存在这么一个问题：一个药企宣称一天需要最少服用50克药品才能发挥药效
# 我们好奇这个药企的说法是否正确，于是我们进行了一个实验，我们随机抽取了服用了这个药品且药效发作了的100个人，让他们服用这个药品
# 我们发现，这100个人服用这个药品的平均剂量是48克，标准差是5克，这是明显低于药企宣称的50克
# 我们想知道，这个药企的说法是否正确，也就是说，这个药企的说法是否有统计学意义
# 这就是假设检验的一个例子，我们通过假设检验来判断一个假设是否成立

# 1.2 - 假设检验的基本思想
# 假设检验的基本思想是：我们假设一个原假设（H0），然后根据样本数据来判断这个原假设是否成立
# 一般来说，原假设是我们想要证伪的假设，也就是我们想要判断是否成立的假设
# 在上述的例子中，原假设是药企的说法正确，也就是服用50克药品才能发挥药效，如果原假设不成立，我们就有理由相信药企的说法不正确
# 同时，我们不能将所有服用这款药品的人的数据统计起来，我们只能抽样并且根据样本数据来判断这个原假设是否成立
# 假设检验的结果有两种可能：接受原假设（H0）或者拒绝原假设（H0），二者互为对立

# 1.3 - 假设检验的基本步骤
# 假设检验的基本步骤如下：
# 1. 确定原假设 Null Hypothesis（H0）和备择假设 Alternative Hypothesis（H1）
# 2. 选择显著性水平（α）
# 3. 根据样本数据计算检验统计量
# 4. 根据检验统计量和显著性水平（α）判断是否拒绝原假设（H0）
# 5. 得出结论，接受或者拒绝原假设（H0），Reject or Failed to Reject H0

# 1.4 - 假设检验的类型
# 假设检验可以分为两种类型：参数假设检验和非参数假设检验
# 参数假设检验是指对总体参数进行假设检验，例如总体均值、总体方差等
# 非参数假设检验是指对总体分布进行假设检验，例如总体服从正态分布、总体服从均匀分布等

# 1.5 - 假设检验的常见问题
# 假设检验的常见问题包括：单样本均值检验、双样本均值检验、方差检验、卡方检验、t检验等
# 单样本均值检验是指对一个总体均值进行假设检验
# 双样本均值检验是指对两个总体均值进行假设检验
# 方差检验是指对一个总体方差进行假设检验
# 卡方检验是指对一个总体分布进行假设检验
# t检验是指对一个总体均值进行假设检验，但是总体方差未知

# 我们直接通过改变已知变量来分类讨论
# 1.6 - 假设检验的显著性水平
# 显著性水平（α）是指在假设检验中，拒绝原假设的概率
# 通常情况下，显著性水平（α）的取值为0.05，也就是5%
# 也就是说，如果我们的显著性水平（α）取值为0.05，那么我们拒绝原假设的概率为5%
# 如果我们的显著性水平（α）取值为0.01，那么我们拒绝原假设的概率为1%
# 显著性水平（α）的取值可以根据具体情况进行调整

# 1.7 - 假设检验的检验统计量
# 假设检验的检验统计量是用来判断原假设是否成立的一个统计量
# 假设检验的检验统计量的选择取决于原假设和备择假设的具体形式
# 假设检验的检验统计量通常是一个标准化的统计量，例如t统计量、z统计量、F统计量、卡方统计量等
# 假设检验的检验统计量的计算方法可以根据具体情况进行调整

# 2.0 - 假设检验中的参数
# 在假设检验中，我们需要确定一些参数，这些参数包括：
# 1. 样本数量 Sample Size（n）
# 2. 样本均值 Sample Mean（X_bar）
# 3. 样本标准差 Sample Standard Deviation（s）
# 4. 总体均值 Population Mean（μ）
# 5. 总体标准差 Population Standard Deviation（σ）
# 6. 显著性水平 Significance Level（α）
# 7. 双尾检验或单尾检验 Two-Tailed Test or One-Tailed Test
# 上面前五五个参数决定了我们应该采用什么样的检验统计量，也就是使用什么分布，而后两个参数决定了拒绝域的大小

# 2.1 - Inference on the Mean of a Normal Population with Known Variance 即是 Z检验
# 在假设检验中，我们经常需要对一个正态总体的均值进行假设检验
# 如果总体的方差已知，我们可以使用Z检验来对总体的均值进行假设检验
# Z检验的基本思想是：我们根据样本数据计算出一个Z统计量，然后根据Z统计量和显著性水平（α）来判断原假设是否成立
# Z检验的步骤如下：
# 1. 确定原假设（H0）和备择假设（H1）
# 2. 选择显著性水平（α）
# 3. 根据样本数据计算Z统计量
# 4. 根据Z统计量和显著性水平（α）判断是否拒绝原假设（H0）
# 5. 得出结论，接受或者拒绝原假设（H0）

# Zn = (X_bar - μ) / (σ / sqrt(n)) ~ N(0, 1)

# eg. 一个药企宣称一天需要最少服用50克药品才能发挥药效
# 我们好奇这个药企的说法是否正确，于是我们进行了一个实验，我们随机抽取了服用了这个药品且药效发作了的100个人，让他们服用这个药品
# 我们发现，这100个人服用这个药品的平均剂量是48克，标准差是5克，这是明显低于药企宣称的50克
# 我们想知道，这个药企的说法是否正确，也就是说，这个药企的说法是否有统计学意义
# 这就是假设检验的一个例子，我们通过假设检验来判断一个假设是否成立
# 我们可以使用Z检验来对这个问题进行假设检验
# 原假设（H0）：μ = 50
# 备择假设（H1）：μ < 50
# 显著性水平（α）：0.05
# 根据样本数据计算Z统计量：Z = (48 - 50) / (5 / sqrt(100)) = -4
# 根据Z统计量和显著性水平（α）判断是否拒绝原假设（H0）
# Z = -4 < -1.645，拒绝原假设（H0）
# 得出结论，拒绝原假设（H0），也就是说，这个药企的说法不正确
# 我们可以使用R语言进行实现
# 代码如下：

  # 假设药企宣称的最小服用剂量为50克
  mu_0 <- 50
  
  # 生成一百个样本数据
  set.seed(123)  # 设置种子以保证结果的可重复性
  data <- rnorm(100, mean = 48, sd = 5)
    # rnorm(n, mean, sd)函数用于生成服从正态分布的随机数
    # n表示生成的随机数的个数, mean表示生成的随机数的均值, sd表示生成的随机数的标准差
  
  # 输出生成的数据、均值和标准差
  cat("生成的数据:", data, "\n")
  cat("生成数据的均值:", mean(data), "\n")
  cat("生成数据的标准差:", sd(data), "\n")
  
  # 样本均值和标准差
  sample_mean <- 48
  sample_sd <- 5
  
  # 样本容量
  n <- length(data)
  
  # 计算Z统计量
  Z <- (sample_mean - mu_0) / (sample_sd / sqrt(n))
  
  # 计算p值
  p_value <- pnorm(Z)
    # pnorm(q)函数用于计算标准正态分布的累积分布函数值即cdf
    # q表示计算累积分布函数值的点
  
  # 显著性水平
  alpha <- 0.05
  
  # 绘制正态分布曲线
  x <- seq(40, 60, length.out = 100)
  y <- dnorm(x, mean = mu_0, sd = sample_sd/sqrt(n))
    # dnorm(x, mean, sd)函数用于计算正态分布的概率密度函数值即pdf
    # x表示计算概率密度函数值的点, mean表示正态分布的均值, sd表示正态分布的标准差
  
  plot(x, y, type = "l", lwd = 2, col = "blue", ylim = c(0, max(y) * 1.1),
       main = "Hypothesis Testing", xlab = "Mean of the  (g)", ylab = "Density")
    # plot函数用于绘制图形
    # type = "l"表示绘制折线图, lwd = 2表示折线的宽度, col = "blue"表示折线的颜色
    # ylim = c(0, max(y) * 1.1)表示y轴的范围
    # main = "Hypothesis Testing"表示图的标题, xlab = "Mean of the  (g)"表示x轴的标签, ylab = "Density"表示y轴的标签
  
  # 标记样本均值
  abline(v = sample_mean, col = "red", lwd = 2)
  text(sample_mean, max(y) * 0.8, "Sample Mean", pos = 4, col = "red")
    # abline函数用于绘制垂直线
    # 标准形式是abline(v = v, col = col, lwd = lwd)
    # v表示垂直线的位置, col表示垂直线的颜色, lwd表示垂直线的宽度
  
    # text函数用于在图中添加文本
    # 标准形式是text(x, y, labels, pos, col)
    # x表示文本的x坐标, y表示文本的y坐标, labels表示文本的内容, pos表示文本的位置, col表示文本的颜色
    # 在这里，我们在样本均值的位置添加了一个文本
    # 具体来说，我们在样本均值的位置添加了一个文本，内容为"Sample Mean"，位置为4，颜色为红色
    # max(y) * 0.8表示文本的y坐标
    # pos = 4表示文本在样本均值的右上方
    # pos还可以取1, 2, 3, 4，分别表示右下方、左下方、左上方、右上方
    # col = "red"表示文本的颜色为红色
  
  # 标记假设的剂量
  abline(v = mu_0, col = "green", lwd = 2)
  text(mu_0, max(y) * 0.8, "Hypothesized Mean", pos = 2, col = "green")
  
  # 标记检验统计量Z
  abline(v = mu_0 + Z * (sample_sd / sqrt(n)), col = "orange", lwd = 2, lty = 2)
  text(mu_0 + Z * (sample_sd / sqrt(n)), max(y) * 0.6, "Z statistic", pos = 2, col = "orange")
  
  # 标记拒绝域
  critical_value <- qnorm(alpha)
  abline(v = mu_0 + critical_value * (sample_sd / sqrt(n)), col = "purple", lwd = 2, lty = 3)
  text(mu_0 + critical_value * (sample_sd / sqrt(n)), max(y) * 0.4, paste("Critical Value (", round(critical_value, 2), ")", sep = ""), pos = 2, col = "purple")
  
  # 添加p值
  text(mu_0 - 1, max(y) * 0.9, paste("p-value =", round(p_value, 4)), pos = 4)
  
  # 添加说明
  legend("topright", legend = c("Density", "Sample Mean", "Hypothesized Mean", "Z statistic", "Critical Value", "p-value"),
         col = c("blue", "red", "green", "orange", "purple", "black"), lty = c(1, 1, 1, 2, 3, NA), lwd = c(2, 2, 2, 2, 2, NA))
    # legend函数用于添加图例
    # 标准形式是legend(x, y, legend, col, lty, lwd)
    # x表示图例的x坐标, y表示图例的y坐标, legend表示图例的内容, col表示图例的颜色, lty表示图例的线型, lwd表示图例的宽度
    # 在这里，我们在右上角添加了一个图例
    # 具体来说，我们在右上角添加了一个图例，内容为"Density", "Sample Mean", "Hypothesized Mean", "Z statistic", "Critical Value", "p-value"
    # 颜色分别为蓝色、红色、绿色、橙色、紫色、黑色
    # 线型分别为实线、实线、实线、虚线、虚线、NA
    # 线型有1、2、3、4、5、6、7，分别表示实线、虚线、点线、点划线、点点线、点点划线、无线型
    # 宽度分别为2、2、2、2、2、NA
  
  # 显示图例
  box()





  